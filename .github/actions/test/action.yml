name: 'Run tests'
description: 'Run tests...'

outputs:
  functions-coverage:
    description: 'Unit test functions coverage'
    value: ${{ steps.extract-coverage-pct.outputs.result}}
runs:
  using: 'composite'
  steps:
    - name: Setup node
      uses: actions/setup-node@v3
      with:
        node-version: 16
    - name: Test
      run: |
        npm ci
        npm run compile
        npm run test:ci-coverage
      shell: bash
    - uses: actions/github-script@v6
      id: extract-coverage-pct
      with:
        result-encoding: string
        script: |
          const coverageSummary = require("./coverage/coverage-summary.json")
          return coverageSummary.total.functions.pct
